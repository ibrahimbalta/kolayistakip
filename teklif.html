<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teklif Detayƒ± - Kolay ƒ∞≈ü Takip</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        body {
            background: linear-gradient(135deg, #2d005f 0%, #5c1e94 50%, #8b24e6 100%);
            min-height: 100vh;
            padding: 35px;
            font-family: 'Inter', sans-serif;
            color: white;
        }

        /* Kurumsal Cam Kart */
        .proposal-card {
            max-width: 780px;
            margin: auto;
            border-radius: 22px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.18);
            border: 1px solid rgba(255,255,255,0.25);
            backdrop-filter: blur(14px);
            box-shadow: 0 25px 45px rgba(0,0,0,0.45);
        }

        /* Premium Header */
        .proposal-header {
            text-align: center;
            padding: 28px;
            border-bottom: 1px solid rgba(255,255,255,0.18);
            position: relative;
            animation: fadeInDown .8s ease;
        }

        .proposal-header .icon {
            font-size: 3.3rem;
            color: #06b6d4;
            animation: glow 2.5s infinite ease-in-out;
        }

        /* Animasyon Efekti */
        @keyframes glow {
            0% { text-shadow: 0 0 6px rgba(0,255,255,0.3); }
            50% { text-shadow: 0 0 18px rgba(0,255,255,0.6); }
            100% { text-shadow: 0 0 6px rgba(0,255,255,0.3); }
        }

        @keyframes fadeInDown {
            0% { opacity:0; transform: translateY(-25px); }
            100% { opacity:1; transform: translateY(0); }
        }

        .proposal-body {
            padding: 35px;
            animation: fadeInUp .65s ease;
        }

        @keyframes fadeInUp {
            0% { opacity:0; transform: translateY(25px); }
            100% { opacity:1; transform: translateY(0); }
        }

        .proposal-title {
            font-size: 1.7rem;
            font-weight: 700;
        }

        .proposal-amount {
            font-size: 2.4rem;
            font-weight: 800;
            margin: 20px 0;
            color: #06b6d4;
        }

        /* Kurumsal √áizgili Panel */
        .proposal-details {
            background: rgba(255,255,255,0.10);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.20);
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.12);
            padding: 10px 0;
        }

        .item-price {
            font-weight: 600;
            color: #06b6d4;
        }

        /* Durum Etiketleri */
        .status-badge {
            padding: 8px 15px;
            border-radius: 22px;
            font-weight: 600;
            font-size: .9rem;
        }

        .status-pending { background: rgba(255,255,255,0.30); color: white; }
        .status-approved { background: rgba(16,185,129,0.30); color: #10b981; }
        .status-rejected { background: rgba(239,68,68,0.30); color: #ef4444; }
        .status-negotiating { background: rgba(245,158,11,0.30); color: #f59e0b; }

        /* Butonlar */
        .btn-action {
            width:100%;
            padding: 14px;
            border-radius: 12px;
            cursor: pointer;
            border: none;
            font-weight: 600;
            margin-top: 9px;
            transition: .25s;
        }

        .btn-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 22px rgba(0,0,0,0.45);
        }

        .btn-approve { background: linear-gradient(90deg,#10b981,#0f8d82); color:#fff; }
        .btn-reject { background: linear-gradient(90deg,#ef4444,#bc1c1c); color:#fff; }
        .btn-negotiate { background: linear-gradient(90deg,#f59e0b,#cb7a06); color:#fff; }

        /* Grafik / Kurumsal Animasyon */
        .mini-graph {
            margin: 0 auto;
            width: 110px;
            height: 110px;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.35);
            border-top-color: #06b6d4;
            animation: spin 2.5s infinite linear;
            margin-bottom:18px;
        }

        @keyframes spin {
            from { transform: rotate(0); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>

<body>

    <div class="proposal-card">

        <div id="loading" style="text-align:center;padding:50px;">
            <div class="mini-graph"></div>
            <p style="opacity:0.85;">Teklif y√ºkleniyor...</p>
        </div>

        <div id="content" style="display:none;">
            <div class="proposal-header">
                <i class="fa-solid fa-file-invoice-dollar icon"></i>
                <h2 style="margin-top:12px; opacity:0.85;">Kurumsal Teklif Bilgileri</h2>
            </div>

            <div class="proposal-body">
                <div style="text-align:center;">
                    <span id="statusBadge" class="status-badge status-pending">Bekliyor</span>
                    <h2 id="pTitle" class="proposal-title"></h2>
                    <div id="pAmount" class="proposal-amount"></div>
                </div>

                <div class="proposal-details">
                    <h3 style="margin-bottom:10px;opacity:0.8;">Teklif Detayƒ±</h3>
                    <div id="itemsContainer"></div>
                    <div id="pDetails" style="margin-top:18px;white-space:pre-wrap;"></div>
                </div>

                <div id="actionButtons">
                    <button onclick="updateStatus('approved')" class="btn-action btn-approve"><i class="fa-solid fa-check"></i> Onaylƒ±yorum</button>
                    <button onclick="updateStatus('negotiating')" class="btn-action btn-negotiate"><i class="fa-solid fa-handshake"></i> Pazarlƒ±k istiyorum</button>
                    <button onclick="updateStatus('rejected')" class="btn-action btn-reject"><i class="fa-solid fa-x"></i> Reddediyorum</button>
                </div>

                <div id="statusMessage" style="margin-top:25px;text-align:center;display:none;font-weight:600;"></div>
            </div>
        </div>
    </div>


<!-- JS KODLARINA DOKUNMADIM -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>
<script>
/* üìå Sadece tasarƒ±m dokunuldu ‚Äî JS %0 deƒüi≈ütirilmedi */
let currentProposalId = null;

async function loadProposal() {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');

    if (!id) {
        document.getElementById('loading').innerHTML = '<p>Teklif bulunamadƒ±.</p>';
        return;
    }

    currentProposalId = id;

    const { data, error } = await supabase.from('proposals').select('*').eq('id', id).single();
    if (error) {
        document.getElementById('loading').innerHTML = '<p>Teklif y√ºklenemedi.</p>';
        return;
    }

    document.getElementById('pTitle').textContent = data.title;
    document.getElementById('pAmount').textContent = `‚Ç∫${data.amount.toLocaleString('tr-TR')}`;
    document.getElementById('pDetails').textContent = data.details || "";

    const itemsContainer = document.getElementById('itemsContainer');
    itemsContainer.innerHTML = "";

    if (data.items?.length) {
        data.items.forEach(item => {
            itemsContainer.innerHTML += `
                <div class="item-row">
                    <span>${item.description}</span>
                    <span class="item-price">‚Ç∫${item.price.toLocaleString('tr-TR')}</span>
                </div>`;
        });
    }

    renderStatus(data.status);
    document.getElementById('loading').style.display = 'none';
    document.getElementById('content').style.display = 'block';
}

function renderStatus(status) {
    const badge = document.getElementById('statusBadge');
    const msg = document.getElementById('statusMessage');
    const actions = document.getElementById('actionButtons');
    badge.className = 'status-badge';

    switch (status) {
        case 'approved':
            badge.classList.add('status-approved');
            badge.textContent = 'Onaylandƒ±';
            actions.style.display = 'none';
            msg.style.display = 'block';
            msg.innerHTML = '‚úî Teklif onaylandƒ±. Te≈üekk√ºr ederiz.';
            break;
        case 'rejected':
            badge.classList.add('status-rejected');
            badge.textContent = 'Reddedildi';
            actions.style.display = 'none';
            msg.style.display = 'block';
            msg.innerHTML = '‚ùå Teklif reddedildi.';
            break;
        case 'negotiating':
            badge.classList.add('status-negotiating');
            badge.textContent = 'Pazarlƒ±k Talebi';
            actions.style.display = 'none';
            msg.style.display = 'block';
            msg.innerHTML = 'ü§ù Pazarlƒ±k talebiniz iletildi.';
            break;
        default:
            badge.classList.add('status-pending');
            badge.textContent = 'Bekliyor';
    }
}

async function updateStatus(newStatus) {
    await supabase.from('proposals').update({ status: newStatus }).eq('id', currentProposalId);
    renderStatus(newStatus);
}

document.addEventListener('DOMContentLoaded', loadProposal);
</script>

</body>
</html>
