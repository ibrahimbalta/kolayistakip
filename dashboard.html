<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kolay Ä°ÅŸ Takip - Panel</title>
    <link rel="stylesheet" href="dashboard.css" />
    <link rel="stylesheet" href="task-list-scroll.css" />
    <link rel="stylesheet" href="dashboard-mobile.css" />
    <link rel="stylesheet" href="subscription-warning.css" />
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <!-- Chart.js for advanced charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />

</head>

<body>
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fa-solid fa-layer-group"></i>
                    Kolay Ä°ÅŸ Takip
                </div>
            </div>
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="user-info">
                    <div id="userNameDisplay" class="user-name">KullanÄ±cÄ±</div>
                    <div class="user-role">YÃ¶netici</div>
                </div>
            </div>
            <nav class="menu">
                <a href="#" class="menu-item active" onclick="switchView('tasks')">
                    <i class="fa-solid fa-list-check"></i> Ä°ÅŸ Listesi
                </a>
                <a href="#" class="menu-item" onclick="switchView('appointments')">
                    <i class="fa-solid fa-calendar-check"></i> Randevular
                </a>
                <a href="#" class="menu-item" onclick="switchView('proposals')">
                    <i class="fa-solid fa-file-invoice-dollar"></i> Teklifler
                </a>
                <a href="#" class="menu-item" onclick="switchView('reservations')">
                    <i class="fa-solid fa-calendar-days"></i> Rezervasyonlar
                </a>
                <a href="#" class="menu-item" onclick="switchView('customers')">
                    <i class="fa-solid fa-user-group"></i> MÃ¼ÅŸteriler
                </a>
                <a href="#" class="menu-item" onclick="switchView('employees')">
                    <i class="fa-solid fa-users"></i> Ã‡alÄ±ÅŸanlar
                </a>
                <a href="#" class="menu-item" onclick="switchView('reports')">
                    <i class="fa-solid fa-chart-pie"></i> Raporlar
                </a>
                <a href="#" class="menu-item" onclick="switchView('settings')">
                    <i class="fa-solid fa-gear"></i> Ayarlar
                </a>
            </nav>
            <button onclick="Auth.logout()" class="logout-btn">
                <i class="fa-solid fa-right-from-bracket"></i> Ã‡Ä±kÄ±ÅŸ Yap
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header-bar">
                <div class="page-title">
                    <h1 id="pageTitle">Panel</h1>
                    <p id="pageSubtitle">BugÃ¼nÃ¼n iÅŸlerini organize et.</p>
                </div>
                <div id="trialBadge" class="trial-badge">
                    <i class="fa-regular fa-clock"></i> Deneme SÃ¼rÃ¼mÃ¼
                </div>
            </header>

            <!-- VIEW: TASKS -->
            <section id="view-tasks" class="view-section">
                <div class="task-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalTasks">0</div>
                        <div class="stat-label">Toplam Ä°ÅŸ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingTasks" style="color:var(--warning);">0</div>
                        <div class="stat-label">Bekleyen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedTasks" style="color:var(--success);">0</div>
                        <div class="stat-label">Tamamlanan</div>
                    </div>
                </div>
                <div class="content-grid">
                    <!-- Add Task Form -->
                    <div class="card">
                        <h2><i class="fa-solid fa-plus-circle" style="color: var(--primary);"></i> Yeni Ä°ÅŸ Ekle</h2>
                        <form id="taskForm">
                            <div class="form-group">
                                <label for="taskDesc">YapÄ±lacak Ä°ÅŸ</label>
                                <textarea id="taskDesc" placeholder="Ã–rn: MÃ¼ÅŸteri X'in sipariÅŸini hazÄ±rla..." required
                                    style="min-height:100px; resize:vertical;"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="customerSelect">MÃ¼ÅŸteri SeÃ§ (Opsiyonel)</label>
                                <select id="customerSelect">
                                    <option value="">MÃ¼ÅŸteri SeÃ§in...</option>
                                </select>
                                <div style="margin-top:8px; font-size:0.85rem; color:var(--secondary);">
                                    Listede yok mu? <a href="#" onclick="switchView('customers')"
                                        style="color:var(--primary); font-weight:600;">Yeni MÃ¼ÅŸteri Ekle</a>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="departmentFilter">Departman SeÃ§</label>
                                <select id="departmentFilter">
                                    <option value="">TÃ¼m Departmanlar</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="employeeSelect">Ã‡alÄ±ÅŸan SeÃ§</label>
                                <select id="employeeSelect" required>
                                    <option value="">Ã‡alÄ±ÅŸan SeÃ§in...</option>
                                </select>
                                <div style="margin-top:8px; font-size:0.85rem; color:var(--secondary);">
                                    Listede yok mu? <a href="#" onclick="switchView('employees')"
                                        style="color:var(--primary); font-weight:600;">Yeni Ã‡alÄ±ÅŸan Ekle</a>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width:100%; margin-top:1rem;">
                                <i class="fa-solid fa-paper-plane"></i> Ä°ÅŸi Ata ve GÃ¶nder
                            </button>
                        </form>
                    </div>
                    <!-- Task List -->
                    <div class="card">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                            <h2><i class="fa-solid fa-list-ul" style="color: var(--primary);"></i> GÃ¶revler</h2>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="all">TÃ¼mÃ¼</button>
                                <button class="filter-btn" data-filter="pending">Bekleyen</button>
                                <button class="filter-btn" data-filter="completed">Tamamlanan</button>
                            </div>
                        </div>
                        <!-- Task Search Bar -->
                        <div style="margin-bottom: 1.5rem;">
                            <div style="position: relative;">
                                <i class="fa-solid fa-search"
                                    style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--secondary); font-size: 0.9rem;"></i>
                                <input type="text" id="taskSearchInput"
                                    placeholder="GÃ¶rev ara (aÃ§Ä±klama, Ã§alÄ±ÅŸan adÄ±, mÃ¼ÅŸteri...)..."
                                    oninput="filterTasks()"
                                    style="width: 100%; padding: 10px 10px 10px 38px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem;" />
                            </div>
                        </div>
                        <div id="taskList" class="task-list">
                            <div class="empty-state" style="text-align:center; padding:3rem 0; color:var(--secondary);">
                                <i class="fa-solid fa-clipboard-list"
                                    style="font-size:3rem; margin-bottom:1rem; opacity:0.3;"></i>
                                <p>HenÃ¼z kayÄ±tlÄ± iÅŸ yok.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- VIEW: APPOINTMENTS -->
            <section id="view-appointments" class="view-section" style="display:none;">
                <!-- Stats -->
                <div class="task-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSlots">0</div>
                        <div class="stat-label">Toplam Slot</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="availableSlots" style="color:var(--success);">0</div>
                        <div class="stat-label">MÃ¼sait</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="reservedSlots" style="color:var(--primary);">0</div>
                        <div class="stat-label">Rezerve</div>
                    </div>
                </div>
                <div class="content-grid">
                    <!-- Calendar -->
                    <div class="card" style="grid-column: 1 / -1;">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                            <h2><i class="fa-solid fa-calendar-days" style="color: var(--primary);"></i> Randevu Takvimi
                            </h2>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="shareViaWhatsApp()" class="btn btn-primary">
                                    <i class="fa-brands fa-whatsapp"></i> WhatsApp ile PaylaÅŸ
                                </button>
                            </div>
                        </div>

                        <!-- Share Link -->
                        <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                            <input type="text" id="shareLink" readonly
                                style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: #f9fafb;"
                                placeholder="Takvim yÃ¼kleniyor...">
                            <button onclick="copyShareLink()" class="btn"
                                style="background: var(--primary); color: white;">
                                <i class="fa-solid fa-copy"></i> Kopyala
                            </button>
                        </div>
                        <!-- Calendar Container -->
                        <div id="appointmentCalendar"></div>

                        <div style="margin-top: 20px; padding: 15px; background: #f9fafb; border-radius: 8px;">
                            <p style="margin: 0; color: var(--secondary); font-size: 0.9rem;">
                                <i class="fa-solid fa-info-circle"></i>
                                <strong>KullanÄ±m:</strong> Takvimde bir zaman dilimi seÃ§erek mÃ¼sait saat ekleyin.
                                YeÅŸil: MÃ¼sait, Mavi: Rezerve edilmiÅŸ. Randevulara tÄ±klayarak detaylarÄ± gÃ¶rebilirsiniz.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: PROPOSALS -->
            <section id="view-proposals" class="view-section" style="display:none;">
                <div class="task-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProposals">0</div>
                        <div class="stat-label">Toplam Teklif</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="approvedProposals" style="color:var(--success);">0</div>
                        <div class="stat-label">Onaylanan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingProposals" style="color:var(--warning);">0</div>
                        <div class="stat-label">Bekleyen</div>
                    </div>
                </div>
                <div class="content-grid">
                    <div class="card">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
                            <h2><i class="fa-solid fa-file-invoice-dollar" style="color: var(--primary);"></i> Teklifler
                            </h2>
                            <button onclick="openProposalModal()" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Yeni Teklif
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>MÃ¼ÅŸteri</th>
                                        <th>BaÅŸlÄ±k</th>
                                        <th>Tutar</th>
                                        <th>Durum</th>
                                        <th>Tarih</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="proposalListBody">
                                    <tr>
                                        <td colspan="6" style="text-align:center; color:var(--secondary);">HenÃ¼z teklif
                                            yok.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: CUSTOMERS -->
            <section id="view-customers" class="view-section" style="display:none;">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
                        <h2><i class="fa-solid fa-user-group" style="color: var(--primary);"></i> MÃ¼ÅŸteri Listesi</h2>
                        <div style="display: flex; gap: 0.75rem;">
                            <button onclick="exportCustomersToExcel()" class="btn"
                                style="background: #10b981; color: white;">
                                <i class="fa-solid fa-file-excel"></i> Excel Ä°ndir
                            </button>
                            <button onclick="exportCustomersToPDF()" class="btn"
                                style="background: #ef4444; color: white;">
                                <i class="fa-solid fa-file-pdf"></i> PDF Ä°ndir
                            </button>
                            <button onclick="showAddCustomerModal()" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Yeni MÃ¼ÅŸteri
                            </button>
                        </div>
                    </div>
                    <!-- Customer Search Bar -->
                    <div style="margin-bottom: 1.5rem;">
                        <div style="position: relative;">
                            <i class="fa-solid fa-search"
                                style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--secondary); font-size: 0.9rem;"></i>
                            <input type="text" id="customerSearchInput"
                                placeholder="MÃ¼ÅŸteri ara (isim, email, telefon, sektÃ¶r...)" oninput="filterCustomers()"
                                style="width: 100%; padding: 10px 10px 10px 38px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 0.95rem;" />
                        </div>
                    </div>
                    <div id="customerCardsGrid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem;">
                        <!-- Customer cards will be rendered here -->
                        <div style="grid-column: 1 / -1; text-align:center; padding:3rem 0; color:var(--secondary);">
                            <i class="fa-solid fa-user-group"
                                style="font-size:3rem; margin-bottom:1rem; opacity:0.3;"></i>
                            <p>HenÃ¼z mÃ¼ÅŸteri eklenmemiÅŸ.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: EMPLOYEES -->
            <section id="view-employees" class="view-section" style="display:none;">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
                        <h2><i class="fa-solid fa-users" style="color: var(--primary);"></i> Ã‡alÄ±ÅŸan Listesi</h2>
                        <button onclick="showAddEmployeeModal()" class="btn btn-primary">
                            <i class="fa-solid fa-plus"></i> Yeni Ã‡alÄ±ÅŸan
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ad Soyad</th>
                                    <th>Telefon</th>
                                    <th>Aktif GÃ¶revler</th>
                                    <th>Departman</th>
                                    <th>Ä°ÅŸlem</th>
                                </tr>
                            </thead>
                            <tbody id="employeeListBody">
                                <tr>
                                    <td colspan="5" style="text-align:center; color:var(--secondary);">HenÃ¼z Ã§alÄ±ÅŸan
                                        eklenmemiÅŸ.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- VIEW: RESERVATIONS -->
            <section id="view-reservations" class="view-section" style="display:none;">
                <div class="content-grid" style="grid-template-columns: 1fr 2fr;">
                    <!-- Form Card -->
                    <div class="card">
                        <h2><i class="fa-solid fa-calendar-days" style="color: var(--primary);"></i> Yeni Alan TanÄ±mlama
                        </h2>
                        <form id="reservationForm">
                            <input type="hidden" id="editReservationId">

                            <div class="form-group">
                                <label for="alanNo">Alan Kodu/NumarasÄ±</label>
                                <input type="text" id="alanNo" required placeholder="Ã–rn: H301, Kort-2">
                            </div>

                            <div class="form-group">
                                <label for="alanTipi">Alan Tipi</label>
                                <select id="alanTipi" required>
                                    <option value="stand">Fuar StandÄ±</option>
                                    <option value="toplanti">ToplantÄ± OdasÄ±</option>
                                    <option value="masa">Coworking MasasÄ±</option>
                                    <option value="kort">Spor Kortu/Saha</option>
                                    <option value="loca">Stadyum LocasÄ±</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="alanBuyukluk">BÃ¼yÃ¼klÃ¼k (mÂ² / KiÅŸi Kapasitesi)</label>
                                <input type="text" id="alanBuyukluk" required placeholder="Ã–rn: 18 mÂ² veya 10 KiÅŸilik">
                            </div>

                            <div class="form-group">
                                <label for="fiyatTipi">FiyatlandÄ±rma Åžekli</label>
                                <select id="fiyatTipi" required>
                                    <option value="saatlik">Saatlik</option>
                                    <option value="gunluk">GÃ¼nlÃ¼k/SeanslÄ±k</option>
                                    <option value="tek_fiyat">Tek Fiyat</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="fiyatMiktar">Fiyat</label>
                                <div style="display: flex; gap: 8px;">
                                    <select id="paraBirimi" style="flex: 0 0 90px;" required>
                                        <option value="TRY">â‚º (TRY)</option>
                                        <option value="USD">$ (USD)</option>
                                        <option value="EUR">â‚¬ (EUR)</option>
                                    </select>
                                    <input type="number" id="fiyatMiktar" min="0" step="0.01" required
                                        placeholder="0.00" style="flex: 1;">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="alanDurum">Mevcut Durum</label>
                                <select id="alanDurum" required>
                                    <option value="bos">BoÅŸ</option>
                                    <option value="opsiyonda">Opsiyonda</option>
                                    <option value="rezerve">Rezerve</option>
                                </select>
                            </div>

                            <!-- Rezervasyon Bilgileri (Durum=rezerve olduÄŸunda gÃ¶rÃ¼nÃ¼r) -->
                            <div id="reservationInfoSection"
                                style="display: none; border-top: 2px solid var(--border); padding-top: 1.5rem; margin-top: 1.5rem;">
                                <h3 style="color: var(--primary); margin-bottom: 1rem; font-size: 1.1rem;">
                                    <i class="fa-solid fa-building"></i> Rezervasyon Bilgileri
                                </h3>

                                <div class="form-group">
                                    <label for="reservedCompany">Firma ÃœnvanÄ±</label>
                                    <input type="text" id="reservedCompany" placeholder="Ã–rn: ABC Tekstil Ltd. Åžti.">
                                </div>

                                <div class="form-group">
                                    <label for="reservedName">Yetkili Ad Soyad</label>
                                    <input type="text" id="reservedName" placeholder="Ã–rn: Ahmet YÄ±lmaz">
                                </div>

                                <div class="form-group">
                                    <label for="reservedPhone">Telefon</label>
                                    <input type="tel" id="reservedPhone" placeholder="(5XX) XXX XX XX">
                                </div>

                                <div class="form-group">
                                    <label for="reservedEmail">E-posta</label>
                                    <input type="email" id="reservedEmail" placeholder="ornek@firma.com">
                                </div>

                                <div class="form-group">
                                    <label for="reservedNotes">Ã–zel Ä°stekler / Notlar</label>
                                    <textarea id="reservedNotes" rows="3"
                                        placeholder="Varsa Ã¶zel istekler veya notlar..."></textarea>
                                </div>
                            </div>


                            <div style="display: flex; gap: 10px; margin-top: 1.5rem; flex-wrap: wrap;">
                                <button type="submit" class="btn btn-primary" id="reservationSubmitBtn"
                                    style="flex: 1;">
                                    <i class="fa-solid fa-plus"></i> Alan Ekle
                                </button>
                                <button type="button" class="btn" style="background: #6366f1; color: white;"
                                    onclick="document.getElementById('krokiFileInput').click()">
                                    <i class="fa-solid fa-image"></i> GÃ¶rsel YÃ¼kle
                                </button>
                                <input type="file" id="krokiFileInput" accept="image/*" style="display: none;"
                                    onchange="uploadKrokiImage(this)">
                                <button type="button" class="btn" style="background: #25d366; color: white;"
                                    onclick="shareReservations()">
                                    <i class="fa-brands fa-whatsapp"></i> PaylaÅŸ
                                </button>
                                <button type="button" class="btn" style="background: #6c757d; color: white;"
                                    onclick="copyReservationLink()">
                                    <i class="fa-solid fa-link"></i> Link
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Cards Grid -->
                    <div class="card">
                        <h2><i class="fa-solid fa-grip" style="color: var(--primary);"></i> TanÄ±mlÄ± Alanlar</h2>
                        <div id="reservationCardsGrid"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin-top: 15px;">
                            <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--secondary);">
                                <i class="fa-solid fa-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                                <p style="margin-top: 10px;">HenÃ¼z alan eklenmemiÅŸ.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: REPORTS -->
            <section id="view-reports" class="view-section" style="display:none;">
                <!-- Export Toolbar -->
                <div class="export-toolbar">
                    <button onclick="exportToExcel()" class="btn btn-export">
                        <i class="fa-solid fa-file-excel"></i> Excel Ä°ndir
                    </button>
                    <button onclick="exportToPDF()" class="btn btn-export">
                        <i class="fa-solid fa-file-pdf"></i> PDF Ä°ndir
                    </button>
                </div>

                <!-- Performance Cards -->
                <div class="performance-cards-grid" id="performanceCards">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Charts Grid -->
                <div class="charts-grid">
                    <!-- Completion Rate Chart -->
                    <div class="card">
                        <h2><i class="fa-solid fa-chart-pie" style="color: var(--primary);"></i> Tamamlanma OranÄ±</h2>
                        <div class="chart-wrapper">
                            <canvas id="completionChart"></canvas>
                        </div>
                        <div id="completionStats" class="chart-stats"></div>
                    </div>

                    <!-- Productivity Trend Chart -->
                    <div class="card">
                        <h2><i class="fa-solid fa-chart-line" style="color: var(--success);"></i> Verimlilik Trendi (Son
                            7 GÃ¼n)</h2>
                        <div class="chart-wrapper">
                            <canvas id="productivityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Employee Performance Table -->
                <div class="card">
                    <h2 style="display: flex; align-items: center; gap: 10px;">
                        <i class="fa-solid fa-ranking-star" style="color: var(--warning);"></i>
                        Ã‡alÄ±ÅŸan Performans DetaylarÄ±
                        <i class="fa-solid fa-circle-info"
                            style="cursor: help; font-size: 0.9rem; color: var(--primary);" title="Performans Skoru Hesaplama:
â€¢ Tamamlanan GÃ¶rev Ã— 10 puan
â€¢ Tamamlanma OranÄ± Ã— 0.5 puan  
â€¢ 5+ gÃ¶rev varsa +10 bonus
Seviyeler:
80-100: MÃ¼kemmel â­
60-79: Ä°yi ðŸ‘
40-59: Orta ðŸ“Š
0-39: GeliÅŸmeli ðŸ“ˆ"></i>
                    </h2>
                    <div class="table-responsive">
                        <table class="data-table analytics-table" id="performanceTable">
                            <thead>
                                <tr>
                                    <th>Ã‡alÄ±ÅŸan</th>
                                    <th>Toplam GÃ¶rev</th>
                                    <th>Tamamlanan</th>
                                    <th>Bekleyen</th>
                                    <th>Tamamlanma OranÄ±</th>
                                    <th>Performans Skoru</th>
                                </tr>
                            </thead>
                            <tbody id="performanceTableBody">
                                <tr>
                                    <td colspan="6" style="text-align:center; color:var(--secondary);">HenÃ¼z veri yok.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- VIEW: SETTINGS -->
            <section id="view-settings" class="view-section" style="display:none;">
                <div class="card" style="max-width:600px; margin:0 auto;">
                    <h2><i class="fa-solid fa-gear" style="color: var(--secondary);"></i> Ayarlar</h2>
                    <form id="settingsForm">
                        <div class="form-group">
                            <label>Firma AdÄ±</label>
                            <input type="text" id="settingCompanyName" />
                        </div>
                        <div class="form-group">
                            <label>KullanÄ±cÄ± AdÄ±</label>
                            <input type="text" id="settingEmail" disabled style="background:#f1f5f9;" />
                        </div>
                        <div class="form-group">
                            <label>Yeni Åžifre (DeÄŸiÅŸtirmek iÃ§in doldurun)</label>
                            <input type="password" id="settingNewPassword" placeholder="Yeni ÅŸifrenizi girin" />
                        </div>
                        <div class="form-group">
                            <label>Yeni Åžifre Tekrar</label>
                            <input type="password" id="settingConfirmPassword"
                                placeholder="Yeni ÅŸifrenizi tekrar girin" />
                        </div>
                        <button type="submit" class="btn btn-primary">Kaydet</button>

                    </form>
                    </form>
                    <!-- Department Management Section -->
                    <hr style="margin:2rem 0; border:0; border-top:1px solid var(--border);" />
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fa-solid fa-building" style="color: var(--primary);"></i>
                            Departman YÃ¶netimi
                        </h3>
                        <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                            <input type="text" id="newDepartmentName" placeholder="Departman adÄ±"
                                style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 8px;" />
                            <button onclick="addDepartment()" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Ekle
                            </button>
                        </div>
                        <div id="departmentList" style="display: flex; flex-direction: column; gap: 8px;">
                            <!-- Departments will be loaded here -->
                        </div>
                    </div>

                    <hr style="margin:2rem 0; border:0; border-top:1px solid var(--border);" />
                    <div style="background:#fef2f2; padding:1.5rem; border-radius:12px; border:1px solid #fecaca;">
                        <h3 style="color:#991b1b; font-size:1.1rem; margin-bottom:0.5rem;">Tehlikeli BÃ¶lge</h3>
                        <p style="color:#b91c1c; font-size:0.9rem; margin-bottom:1rem;">TÃ¼m verilerinizi (gÃ¶revler,
                            Ã§alÄ±ÅŸanlar) kalÄ±cÄ± olarak siler.</p>
                        <button onclick="clearAllData()" class="btn btn-delete" style="width:auto;">Verileri
                            SÄ±fÄ±rla</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card">
            <h2 style="margin-bottom:1.5rem;"><i class="fa-solid fa-user-plus" style="color: var(--primary);"></i> Yeni
                Ã‡alÄ±ÅŸan Ekle</h2>
            <form id="addEmployeeForm">
                <div class="form-group">
                    <label>Ad Soyad</label>
                    <input type="text" id="newEmpName" required placeholder="Ã–rn: Ahmet YÄ±lmaz" />
                </div>
                <div class="form-group">
                    <label>Telefon</label>
                    <input type="tel" id="newEmpPhone" required placeholder="5XX XXX XX XX" />
                </div>
                <div class="form-group">
                    <label>Departman (Opsiyonel)</label>
                    <select id="newEmpDepartment">
                        <option value="">Departman SeÃ§iniz</option>
                        <!-- Departments will be loaded dynamically -->
                    </select>
                </div>
                <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" onclick="closeAddEmployeeModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Employee Modal -->
    <div id="editEmployeeModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card">
            <h2 style="margin-bottom:1.5rem;"><i class="fa-solid fa-pen-to-square" style="color: var(--primary);"></i>
                Ã‡alÄ±ÅŸan DÃ¼zenle</h2>
            <form id="editEmployeeForm">
                <input type="hidden" id="editEmpId" />
                <div class="form-group">
                    <label>Ad Soyad</label>
                    <input type="text" id="editEmpName" required placeholder="Ã–rn: Ahmet YÄ±lmaz" />
                </div>
                <div class="form-group">
                    <label>Telefon</label>
                    <input type="tel" id="editEmpPhone" required placeholder="5XX XXX XX XX" />
                </div>
                <div class="form-group">
                    <label>Departman (Opsiyonel)</label>
                    <select id="editEmpDepartment">
                        <option value="">Departman SeÃ§iniz</option>
                        <!-- Departments will be loaded dynamically -->
                    </select>
                </div>
                <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" onclick="closeEditEmployeeModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">GÃ¼ncelle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card">
            <h2 style="margin-bottom:1.5rem;"><i class="fa-solid fa-user-plus" style="color: var(--primary);"></i> Yeni
                MÃ¼ÅŸteri KartÄ±</h2>
            <form id="addCustomerForm">
                <div class="form-group">
                    <label>Ad Soyad <span style="color: red;">*</span></label>
                    <input type="text" id="newCustomerName" required placeholder="Ã–rn: Ahmet YÄ±lmaz" />
                </div>
                <div class="form-group">
                    <label>E-posta Adresi <span style="color: red;">*</span></label>
                    <input type="email" id="newCustomerEmail" required placeholder="ornek@email.com" />
                </div>
                <div class="form-group">
                    <label>Telefon Numara <span style="color: red;">*</span></label>
                    <input type="tel" id="newCustomerPhone" required placeholder="5XX XXX XX XX" />
                </div>
                <div class="form-group">
                    <label>SektÃ¶r / Ä°ÅŸ AlanÄ± <span style="color: red;">*</span></label>
                    <input type="text" id="newCustomerSector" required placeholder="Ã–rn: Teknoloji, SaÄŸlÄ±k, EÄŸitim" />
                </div>
                <div class="form-group">
                    <label>Durum <span style="color: red;">*</span></label>
                    <select id="newCustomerStatus" required>
                        <option value="Aktif" selected>Aktif</option>
                        <option value="Potansiyel">Potansiyel</option>
                        <option value="Pasif">Pasif</option>
                    </select>
                </div>
                <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" onclick="closeAddCustomerModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card">
            <h2 style="margin-bottom:1.5rem;"><i class="fa-solid fa-pen-to-square" style="color: var(--primary);"></i>
                MÃ¼ÅŸteri DÃ¼zenle</h2>
            <form id="editCustomerForm">
                <input type="hidden" id="editCustomerId" />
                <div class="form-group">
                    <label>Ad Soyad <span style="color: red;">*</span></label>
                    <input type="text" id="editCustomerName" required placeholder="Ã–rn: Ahmet YÄ±lmaz" />
                </div>
                <div class="form-group">
                    <label>E-posta Adresi <span style="color: red;">*</span></label>
                    <input type="email" id="editCustomerEmail" required placeholder="ornek@email.com" />
                </div>
                <div class="form-group">
                    <label>Telefon Numara <span style="color: red;">*</span></label>
                    <input type="tel" id="editCustomerPhone" required placeholder="5XX XXX XX XX" />
                </div>
                <div class="form-group">
                    <label>SektÃ¶r / Ä°ÅŸ AlanÄ± <span style="color: red;">*</span></label>
                    <input type="text" id="editCustomerSector" required placeholder="Ã–rn: Teknoloji, SaÄŸlÄ±k, EÄŸitim" />
                </div>
                <div class="form-group">
                    <label>Durum <span style="color: red;">*</span></label>
                    <select id="editCustomerStatus" required>
                        <option value="Aktif">Aktif</option>
                        <option value="Potansiyel">Potansiyel</option>
                        <option value="Pasif">Pasif</option>
                    </select>
                </div>
                <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" onclick="closeEditCustomerModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">GÃ¼ncelle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Tasks Modal -->
    <div id="customerTasksModal" class="modal-overlay" style="display:none;"
        onclick="if(event.target === this) closeCustomerTasksModal()">
        <div class="modal-content card" style="max-width: 700px; max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">
                    <i class="fa-solid fa-list-check" style="color: var(--primary);"></i>
                    <span id="customerTasksModalTitle">MÃ¼ÅŸteri GÃ¶revleri</span>
                </h2>
                <button onclick="closeCustomerTasksModal()"
                    style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--secondary); padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div id="customerTasksListContainer">
                <!-- Tasks will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="security.js"></script>
    <script src="auth.js"></script>

    <script src="app.js"></script>
    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.10/locales/tr.global.min.js'></script>
    <script src="appointments.js"></script>
    <script src="proposals.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const user = await Auth.checkAuth();
            if (user) {
                document.getElementById('userNameDisplay').textContent = user.company_name || user.username;

                const badge = document.getElementById('trialBadge');
                if (user.is_premium) {
                    badge.style.background = '#dcfce7';
                    badge.style.color = '#166534';
                    badge.innerHTML = '<i class="fa-solid fa-crown"></i> Premium Ãœyelik';
                } else {
                    const daysLeft = Auth.getDaysLeft(user);
                    if (daysLeft < 0) {
                        badge.style.background = '#fee2e2'; badge.style.color = '#991b1b';
                        badge.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i> SÃ¼re Doldu';
                    } else {
                        badge.innerHTML = `<i
        class="fa-regular fa-clock"></i> ${daysLeft} GÃ¼n KaldÄ±`;
                    }
                }
            }
        });
    </script>

    <!-- Slot Modal -->
    <div id="slotModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card" style="max-height: 85vh; overflow-y: auto;">
            <h2 style="margin-bottom:1rem;">
                <i class="fa-solid fa-calendar-plus" style="color: var(--primary);"></i> Yeni Zaman Dilimi
            </h2>
            <form id="slotForm">
                <div class="form-group">
                    <label>Tarih</label>
                    <input type="date" id="slotDate" required />
                </div>
                <div class="form-group">
                    <label>Saat</label>
                    <input type="time" id="slotTime" required />
                </div>
                <div class="form-group">
                    <label>SÃ¼re (Dakika)</label>
                    <select id="slotDuration" required>
                        <option value="30">30 dakika</option>
                        <option value="60" selected>1 saat</option>
                        <option value="90">1.5 saat</option>
                        <option value="120">2 saat</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>MÃ¼ÅŸteri SeÃ§ (Opsiyonel)</label>
                    <select id="slotCustomerSelect">
                        <option value="">MÃ¼ÅŸteri SeÃ§in...</option>
                        <!-- Will be populated from customers list -->
                    </select>
                    <div style="margin-top:8px; font-size:0.85rem; color:var(--secondary);">
                        Listede yok mu? <a href="#" onclick="switchView('customers')"
                            style="color:var(--primary); font-weight:600;">Yeni MÃ¼ÅŸteri Ekle</a>
                    </div>
                </div>

                <div style="border-top: 1px solid #e5e7eb; margin: 1rem 0; padding-top: 1rem;">
                    <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem; color: var(--primary);">
                        <i class="fa-solid fa-user-pen"></i> DoÄŸrudan Randevu (Opsiyonel)
                    </h3>
                    <p style="font-size: 0.8rem; color: var(--secondary); margin-bottom: 1rem;">
                        EÄŸer boÅŸ bÄ±rakÄ±rsanÄ±z "MÃ¼sait" olarak aÃ§Ä±lÄ±r. DoldurursanÄ±z direkt randevu oluÅŸturulur.
                    </p>
                    <div class="form-group">
                        <label>MÃ¼ÅŸteri AdÄ± SoyadÄ±</label>
                        <input type="text" id="slotCustomerName" placeholder="Ã–rn: AyÅŸe Demir" />
                    </div>
                    <div class="form-group">
                        <label>MÃ¼ÅŸteri Telefon</label>
                        <input type="tel" id="slotCustomerPhone" placeholder="Ã–rn: 5XX XXX XX XX" />
                    </div>
                </div>

                <div style="display:flex; gap:1rem; margin-top:1rem;">
                    <button type="button" onclick="closeSlotModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Ekle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Proposal Modal -->
    <div id="proposalModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card" style="max-width: 600px; width: 95%; max-height: 85vh; overflow-y: auto;">
            <h2 style="margin-bottom:1.5rem; color: #0ea5e9; display: flex; align-items: center; gap: 10px;">
                <i class="fa-solid fa-file-signature"></i> Fiyat Teklifi OluÅŸtur
            </h2>
            <form id="proposalForm">
                <div class="form-group">
                    <label style="font-weight: 600; color: #334155;">MÃ¼ÅŸteri AdÄ± / Firma:</label>
                    <input type="text" id="propCustomerName" required placeholder="Ã–rn: Mehmet Demir"
                        style="border: 1px solid #cbd5e1; padding: 10px; border-radius: 6px; width: 100%;" />
                </div>
                <div class="form-group">
                    <label style="font-weight: 600; color: #334155;">MÃ¼ÅŸteri WhatsApp NumarasÄ± (Opsiyonel):</label>
                    <input type="tel" id="propCustomerPhone" placeholder="5XX XXX XX XX"
                        style="border: 1px solid #cbd5e1; padding: 10px; border-radius: 6px; width: 100%;" />
                </div>

                <div class="form-group">
                    <label style="font-weight: 600; color: #334155;">Teklif BaÅŸlÄ±ÄŸÄ±:</label>
                    <input type="text" id="propTitle" required placeholder="Ã–rn: Web Sitesi TasarÄ±mÄ±"
                        style="border: 1px solid #cbd5e1; padding: 10px; border-radius: 6px; width: 100%;" />
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="font-size: 1.1rem; font-weight: 600; color: #334155; margin-bottom: 10px;">ÃœrÃ¼n/Hizmet
                        Kalemleri</h3>

                    <div id="proposalItemsContainer" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Dynamic Items will be added here -->
                    </div>

                    <button type="button" onclick="Proposals.addItem()" class="btn"
                        style="background: #22c55e; color: white; margin-top: 10px; display: inline-flex; align-items: center; gap: 5px;">
                        <i class="fa-solid fa-plus"></i> Yeni Kalem Ekle
                    </button>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label style="font-weight: 600; color: #334155;">Ek Notlar:</label>
                    <textarea id="propDetails" rows="3" placeholder="Teklif detaylarÄ±nÄ± buraya yazÄ±n..."
                        style="border: 1px solid #cbd5e1; padding: 10px; border-radius: 6px; width: 100%;"></textarea>
                </div>

                <div style="text-align: right; margin-top: 20px; font-size: 1.2rem; font-weight: 700; color: #0ea5e9;">
                    Toplam Tutar: <span id="propTotalAmount">â‚º0.00</span>
                </div>

                <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" onclick="closeProposalModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Teklifi Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firma Ekleme Modal -->
    <div id="firmaModal" class="modal-overlay" style="display:none;">
        <div class="modal-content card">
            <h2 style="margin-bottom:1.5rem;"><i class="fa-solid fa-building" style="color: var(--primary);"></i> Firma
                Bilgileri Ekle</h2>
            <form id="firmaModalForm" onsubmit="saveFirmaToReservation(event)">
                <input type="hidden" id="firmaModalReservationId">

                <div class="form-group">
                    <label>Firma ÃœnvanÄ± *</label>
                    <input type="text" id="modalFirmaName" required placeholder="Ã–rn: ABC Tekstil Ltd. Åžti.">
                </div>

                <div class="form-group">
                    <label>Yetkili Ad Soyad</label>
                    <input type="text" id="modalYetkili" placeholder="Ã–rn: Ahmet YÄ±lmaz">
                </div>

                <div class="form-group">
                    <label>Telefon</label>
                    <input type="tel" id="modalTelefon" placeholder="5XX XXX XX XX">
                </div>

                <div class="form-group">
                    <label>E-posta</label>
                    <input type="email" id="modalEmail" placeholder="ornek@firma.com">
                </div>

                <div class="form-group">
                    <label>Ã–zel Ä°stekler / Notlar</label>
                    <textarea id="modalNotes" rows="3" placeholder="Varsa Ã¶zel istekler veya notlar..."></textarea>
                </div>

                <div style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" onclick="closeFirmaModal()" class="btn"
                        style="background:#f1f5f9; color:var(--dark);">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Kaydet ve Rezerve Et</button>
                </div>
            </form>
        </div>
    </div>

    <script src="subscription-warning.js"></script>
</body>

</html>